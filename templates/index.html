<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>{{ site.brand.name }} — {{ site.brand.tagline or "Precision Detailing. Showroom Results." }}</title>

  <!-- Theme vars from DB/env with safe fallbacks -->
  <style>
    :root{
      /* darker, automotive vibe by default */
      --brand-grad-start: {{ site.theme.gradient_start or '#0ea5e9' }};  /* sky/cyan */
      --brand-grad-end:   {{ site.theme.gradient_end   or '#0f172a' }};  /* slate/near-black */

      /* page-level accents derived from brand vars */
      --ink:#0b1424;
      --muted:#6b7280;
      --panel:#0b1220;            /* dark panel bg */
      --panel-2:#0a0f1a;
      --line:rgba(255,255,255,.08);
      --page: #0b1220;            /* page background */
      --btn-fg:#ffffff;
    }

    /* Override a few light defaults from style.css to a darker shell */
    body{
      background: radial-gradient(900px 700px at 12% 8%, rgba(14,165,233,.15), transparent 60%),
                  radial-gradient(900px 700px at 85% 92%, rgba(2,132,199,.12), transparent 60%),
                  linear-gradient(180deg, #0d1322, #0a0f1a);
      color:#e5e7eb;
    }

    header{
      background:rgba(8,12,20,.75);
      border-bottom:1px solid var(--line);
    }
    .nav a{ color:#cbd5e1; }
    .nav a:hover{ color:#93c5fd; }
    .brand{
      background:linear-gradient(90deg,var(--brand-grad-start),var(--brand-grad-end));
      -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
    }

    .card{
      background:linear-gradient(180deg, rgba(15,23,42,.92), rgba(10,15,26,.88));
      border:1px solid var(--line);
      box-shadow:0 18px 40px rgba(0,0,0,.45);
    }
    .muted{ color:#94a3b8; }
    .btn-primary{
      color:var(--btn-fg);
      background:linear-gradient(90deg,var(--brand-grad-start),var(--brand-grad-end));
    }

    /* Hero */
    .hero{ padding:72px 0 54px; }
    .hero-copy h2{ color:#e5e7eb; }
    .hero-copy p{ color:#9fb3c8; }

    /* Orbs: cool blue/cyan glows */
    .orb{opacity:.35; filter:blur(24px);}
    .orb-a{background:radial-gradient(circle at 30% 30%, #0ea5e9, transparent 60%);}
    .orb-b{background:radial-gradient(circle at 70% 40%, #0891b2, transparent 60%);}
    .orb-c{background:radial-gradient(circle at 50% 50%, #38bdf8, transparent 60%);}

    /* Hero media */
    .hero-media .slide{ filter:saturate(1.05) contrast(1.08) brightness(.92); }
    .hero-media .glaze{
      background:
        radial-gradient(60% 60% at 30% 20%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(60% 60% at 80% 70%, rgba(0,0,0,.35), transparent 60%);
    }
    .filmgrain{opacity:.12}

    /* Sections */
    .services{ background:linear-gradient(180deg, rgba(13,19,34,.6), rgba(10,15,26,.4)); }
    .about{ background:linear-gradient(180deg, #0a0f1a, #0b1220); }
    .reviews{ background:#0b1220; }
    .contact{ background:linear-gradient(180deg, #0b1220, #0c1322); }
    footer{
      border-top:1px solid var(--line);
      background:rgba(8,12,20,.8);
      color:#94a3b8;
    }

    /* Service cards text */
    .service-card h3{ color:#e2e8f0; }
    .service-card p{ color:#9fb3c8; }

    /* Headings */
    .section h2{ color:#e2e8f0; }
    .about-text h3{ color:#e2e8f0; }
    .about-text p{ color:#a5b4c4; }

    /* Contact form overrides for dark */
    #contact-form input,#contact-form textarea{
      background:#0f172a; color:#e5e7eb; border:1px solid #1e293b;
    }
    #contact-form input::placeholder,#contact-form textarea::placeholder{ color:#6b7280; }
    #contact-form input:focus,#contact-form textarea:focus{
      border-color:#0ea5e9; box-shadow:0 0 0 4px rgba(14,165,233,.15);
    }

    /* Reviews */
    .review-card{ background:rgba(2,132,199,.10); }
    .review-text{ color:#e2e8f0; }
    .review-stars{ color:#f59e0b; }

    /* Mobile tweaks keep from original; just color-safe */
    @media (max-width:760px){
      .nav.open{
        background:#0d1322; border:1px solid var(--line);
      }
    }
  </style>

  <!-- Base styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='detail.css') }}">
</head>
<body>
  <!-- Animated background canvas -->
  <canvas id="bgCanvas" class="bg-canvas" aria-hidden="true"></canvas>
  <!-- Soft cursor glow -->
  <div id="cursorGlow" aria-hidden="true"></div>

  <!-- Header -->
  <header>
    <div class="container header-inner">
      <h1 class="brand">{{ site.brand.name }}</h1>
      <button class="menu-btn" id="menuBtn" aria-label="Open menu">Menu</button>
      <nav id="mainNav" class="nav">
        <a href="/">Home</a>
        <a href="#services">Services</a>
        <a href="#contact-section">Contact</a>
        <a class="btn btn-primary" href="{{ site.hero.cta_url }}">{{ site.hero.cta_text }}</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="orbs" aria-hidden="true">
      <span class="orb orb-a"></span>
      <span class="orb orb-b"></span>
      <span class="orb orb-c"></span>
    </div>

    <div class="container hero-grid">
      <div class="hero-copy">
        <h2>{{ site.brand.tagline or "Precision Detailing. Showroom Results." }}</h2>
        <p>{{ site.hero.subtext or "Paint correction, ceramic coatings, interior deep clean, and premium hand washes — done right and on your schedule." }}</p>
        <a href="{{ site.hero.cta_url }}" id="bookCta" class="btn btn-primary">{{ site.hero.cta_text }}</a>
      </div>

      <!-- Art/photo panel (Ken Burns + crossfade + glaze) -->
      <div class="hero-media card">
        <div class="slides">
          {% if site.hero.images and site.hero.images|length > 0 %}
            {% for url in site.hero.images %}
              <img class="slide s{{ loop.index }}" src="{{ url }}" alt="Hero {{ loop.index }} — {{ site.brand.name }}">
            {% endfor %}
          {% else %}
            <!-- Detailing fallbacks -->
            <img class="slide s1" src="{{ url_for('static', filename='detail1.jpg') }}" alt="Paint correction">
            <img class="slide s2" src="{{ url_for('static', filename='detail2.jpg') }}" alt="Ceramic coating">
            <img class="slide s3" src="{{ url_for('static', filename='detail3.jpg') }}" alt="Interior detailing">
          {% endif %}
        </div>
        <div class="glaze"></div>
        <div class="filmgrain" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="section services" id="services">
    <div class="container">
      <h2>Services</h2>

      <div class="grid grid-3">
        {% if site.services and site.services|length > 0 %}
          {% for s in site.services %}
          <div class="card service-card">
            <h3>{{ s.name }}</h3>
            {% if s.description %}<p>{{ s.description }}</p>{% endif %}
            {% if s.price %}<p class="muted">{{ s.price }}</p>{% endif %}
          </div>
          {% endfor %}
        {% else %}
          <!-- Detailing fallbacks if no DB data yet -->
          <div class="card service-card">
            <h3>Exterior Hand Wash</h3>
            <p>Foam bath, pH-safe wash, wheel & tire clean, hand dry.</p>
          </div>
          <div class="card service-card">
            <h3>Interior Deep Clean</h3>
            <p>Vacuum, steam clean, plastics recondition, streak-free glass.</p>
          </div>
          <div class="card service-card">
            <h3>Paint Correction</h3>
            <p>Single or multi-step polish to remove swirls & haze.</p>
          </div>
          <div class="card service-card">
            <h3>Ceramic Coating</h3>
            <p>Long-term protection, extreme gloss, easy maintenance.</p>
          </div>
          <div class="card service-card">
            <h3>Engine Bay Detail</h3>
            <p>Careful degrease and dress for a crisp factory look.</p>
          </div>
          <div class="card service-card">
            <h3>Headlight Restoration</h3>
            <p>Clarity & protection for a safer, newer look.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- About -->
  <section class="about">
    <div class="container about-grid">
      <div class="about-image card" data-parallax data-speed="0.15">
        <img src="{{ url_for('static', filename='detail1.jpg') }}" alt="{{ site.brand.name }} work 1">
      </div>
      <div class="about-text">
        <h3>{{ site.brand.name }}</h3>
        <p>{{ site.brand.tagline or "We use pro-grade products and careful technique to protect your finish and make it shine." }}</p>
        <p><strong>We sweat the details so you don’t have to.</strong></p>
      </div>
      <div class="about-image card" data-parallax data-speed="-0.12">
        <img src="{{ url_for('static', filename='detail3.jpg') }}" alt="{{ site.brand.name }} work 2">
      </div>
    </div>
  </section>

  <!-- Reviews (marquee) -->
  <section class="section reviews" aria-labelledby="reviews-title">
    <div class="container">
      <h2 id="reviews-title">What Drivers Say</h2>

      <div class="reviews-marquee">
        <!-- track 1 -->
        <ul class="marquee-track" role="list">
          {% if site.reviews and site.reviews|length > 0 %}
            {% for r in site.reviews %}
            <li class="review-card card">
              <p class="review-text">“{{ r.text }}”</p>
              {% if r.author %}<p class="review-author">— {{ r.author }}</p>{% endif %}
              <p class="review-stars">{% set stars = r.stars or 5 %}{{ "★" * stars }}</p>
            </li>
            {% endfor %}
          {% else %}
            <li class="review-card card"><p class="review-text">“Paint looks brand new. Swirls gone.”</p><p class="review-author">— Mike</p><p class="review-stars">★★★★★</p></li>
            <li class="review-card card"><p class="review-text">“Fast, professional, and meticulous.”</p><p class="review-author">— Jenna</p><p class="review-stars">★★★★★</p></li>
            <li class="review-card card"><p class="review-text">“Ceramic is insanely glossy.”</p><p class="review-author">— Rob</p><p class="review-stars">★★★★★</p></li>
          {% endif %}
        </ul>

        <!-- duplicate track for a seamless loop -->
        <ul class="marquee-track" aria-hidden="true" role="list">
          {% if site.reviews and site.reviews|length > 0 %}
            {% for r in site.reviews %}
            <li class="review-card card">
              <p class="review-text">“{{ r.text }}”</p>
              {% if r.author %}<p class="review-author">— {{ r.author }}</p>{% endif %}
              <p class="review-stars">{% set stars = r.stars or 5 %}{{ "★" * stars }}</p>
            </li>
            {% endfor %}
          {% else %}
            <li class="review-card card"><p class="review-text">“Interior feels factory fresh.”</p><p class="review-author">— Alex</p><p class="review-stars">★★★★★</p></li>
            <li class="review-card card"><p class="review-text">“Worth every penny.”</p><p class="review-author">— Priya</p><p class="review-stars">★★★★★</p></li>
            <li class="review-card card"><p class="review-text">“Highly recommend the coating.”</p><p class="review-author">— Dan</p><p class="review-stars">★★★★★</p></li>
          {% endif %}
        </ul>

        <div class="marquee-fade left" aria-hidden="true"></div>
        <div class="marquee-fade right" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section class="contact" id="contact-section">
    <div class="container">
      <h2><span style="color:#93c5fd">Get a Quote</span> <span style="color:#38bdf8">Contact Us</span></h2>
      <div class="contact-grid">
        <div class="contact-info card">
          <h3 style="color:#e2e8f0">Address</h3>
          <p>{{ site.contact.address or "Your Shop Address" }}</p>
          {% if site.contact.phone %}<p><strong>Phone:</strong> {{ site.contact.phone }}</p>{% endif %}
          {% if site.contact.email %}<p><strong>Email:</strong> {{ site.contact.email }}</p>{% endif %}

          {% if site.contact.map_embed %}
            <iframe src="{{ site.contact.map_embed }}" width="100%" height="200" style="border:0" loading="lazy" allowfullscreen></iframe>
          {% elif site.contact.address %}
            <iframe src="https://www.google.com/maps?q={{ site.contact.address | urlencode }}&output=embed" width="100%" height="200" style="border:0" loading="lazy" allowfullscreen></iframe>
          {% endif %}
        </div>

        <form id="contact-form" class="card">
          <input type="text" name="name" placeholder="Name" required />
          <input type="email" name="email" placeholder="Email" required />
          <input type="tel" id="phone" name="phone" placeholder="Phone number" maxlength="14" />
          <textarea name="message" placeholder="Vehicle, service, preferred date…" required></textarea>
          <button type="submit" class="btn btn-primary">Submit</button>
          <p id="contact-status" class="muted"></p>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container"><p>© {{ site.brand.name }}. All rights reserved.</p></div>
  </footer>

  <!-- JS -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const mainNav = document.getElementById('mainNav');
    if (menuBtn && mainNav) menuBtn.addEventListener('click', () => mainNav.classList.toggle('open'));

    // Phone mask
    const phone = document.getElementById('phone');
    if (phone) phone.addEventListener('input', (e) => {
      let v = e.target.value.replace(/\D/g,'');
      if (v.length > 0) v = '(' + v;
      if (v.length > 4) v = v.slice(0,4) + ') ' + v.slice(4);
      if (v.length > 9) v = v.slice(0,9) + '-' + v.slice(9,13);
      e.target.value = v;
    });

    // Contact AJAX
    const form = document.getElementById('contact-form');
    if (form){
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const status = document.getElementById('contact-status');
        status.textContent = 'Sending…';
        const payload = { name: form.name.value, email: form.email.value, phone: form.phone.value, message: form.message.value };
        try{
          const res = await fetch('/api/contact',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
          const data = await res.json().catch(()=>({}));
          if (res.ok && data.ok){ status.textContent = 'Thanks! We’ll reply soon.'; form.reset(); }
          else { status.textContent = data.error || 'Something went wrong. Please try again.'; }
        }catch{ status.textContent = 'Network error. Please try again.'; }
      });
    }

    // Parallax + reveal
    const parallaxEls = document.querySelectorAll('[data-parallax]');
    const onScroll = () => {
      const t = window.scrollY;
      parallaxEls.forEach(el=>{
        const speed = parseFloat(el.dataset.speed || 0.1);
        el.style.transform = `translateY(${t*speed}px)`;
      });
    };
    onScroll(); window.addEventListener('scroll', onScroll, {passive:true});

    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }});
    }, {threshold:.12});
    reveals.forEach(el=> io.observe(el));

    // Cursor glow
    const glow = document.getElementById('cursorGlow');
    if (glow){
      window.addEventListener('pointermove', (e)=>{
        glow.style.transform = `translate(${e.clientX - 75}px, ${e.clientY - 75}px)`;
      }, {passive:true});
    }

    // ===== Canvas background (cool blues) =====
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    function size(){
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.width = innerWidth*dpr; canvas.height = innerHeight*dpr;
      canvas.style.width = innerWidth + 'px'; canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    size(); addEventListener('resize', size);

    const COUNT = 180;
    const parts = new Array(COUNT).fill(0).map(()=>({
      x: Math.random()*innerWidth, y: Math.random()*innerHeight,
      v: .55 + Math.random()*1.25, w: .7 + Math.random()*1.2,
      life: 80 + Math.random()*150, hue: 195 + Math.random()*30  // blue/cyan band
    }));

    let t = 0, last = performance.now();
    function field(x,y){ const s=.0011; return Math.sin((x+y)*s + t*.6) + Math.cos((x-y)*s*.9 - t*.35); }

    function draw(now){
      const dt = Math.min(40, now-last); last = now; t += dt/9000;

      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = 'rgba(8,12,20,0.25)';  // darker fade
      ctx.fillRect(0,0,innerWidth,innerHeight);

      ctx.globalCompositeOperation = 'lighter';
      parts.forEach(p=>{
        const a = field(p.x, p.y);
        const vx = Math.cos(a)*p.v, vy = Math.sin(a)*p.v;

        ctx.strokeStyle = `hsla(${p.hue}, 80%, 60%, 0.18)`;
        ctx.lineWidth = p.w;
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        p.x += vx * dt*0.06; p.y += vy * dt*0.06;
        ctx.lineTo(p.x, p.y); ctx.stroke();

        p.hue += 0.04; if (p.hue>225) p.hue = 195;
        if (--p.life<0 || p.x<-120 || p.x>innerWidth+120 || p.y<-120 || p.y>innerHeight+120){
          p.x=Math.random()*innerWidth; p.y=Math.random()*innerHeight; p.life=80+Math.random()*150;
        }
      });
      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);
  });
  </script>
</body>
</html>
